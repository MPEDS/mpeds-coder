{% extends "layout.html" %}
{% block body %}
{% set candidate_cell_buttons = [('plus', 'Add to canonical event'), ('info-sign', '')] -%}
{% set event_buttons = [('plus-sign', 'Add all values'), ('link', 'Link to canonical event'), 
    ('flag', 'Flag for later'), ('check', 'Mark completed'), ('remove-sign', 'Remove from grid')] -%}
<script src="{{ url_for('static', filename='shared.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='adj.js') }}" type="text/javascript"></script>
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
        <div class="error" id="flash-error" style="display:none;"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-5 adj-pane" id="adj-pane-cand-events">
        <a id="cand-events-hide" href="#">&laquo; Hide Pane</a>
        <h4>Event Selection</h4>
        <ul class="nav nav-tabs" id="adj-tabselecter">
            <li class="tablinks active" id="filters_button">
                <a href="#">Filters</a>
            </li>
            <li class="tablinks" id="cand_button">
                <a href="#">Candidate Events</a>
            </li>
            <li class="tablinks" id="canon_button">
                <a href="#">Canonical Events</a>
            </li>
            <li class="tablinks" id="relationships_button">
                <a href="#">Relationships</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane" id="filters_block">
                <div id="adj-filters">
                    <label>Filters</label>
                    <div class="adj-variable-group">
                        <span class="adj-variable"><code>location</code> contains 'Chicago' <a class="glyphicon glyphicon-remove"></a></span>
                        <span class="adj-variable"><code>start_date</code> &gt;= '2016-05-24' <a class="glyphicon glyphicon-remove"></a></span> 
                    </div>
                </div>
                <div id="adj-sorting">
                    <label>Sort</label>
                    <div class="adj-variable-group">    
                        <span class="adj-variable"><code>location</code> asc <a class="glyphicon glyphicon-remove"></a></span>
                        <span class="adj-variable"><code>start_date</code> desc <a class="glyphicon glyphicon-remove"></a></span> 
                    </div>
                </div>
                <hr />
                <label>Add filters</label>
                <form> 
                    <div class="form-row">
                        <div class="form-group col-sm-6">
                            <input class="form-control form-control-sm " 
                                   name="filter-field" 
                                   type="text" 
                                   placeholder = "Field..."/>
                        </div>
                        <div class="form-group col-sm-6">
                            <select class="form-control form-control-sm" name="filter-compare">
                              <option>equals</option>
                              <option>is greater than</option>
                              <option>is greater than or equal to</option>
                              <option>is less than</option>
                              <option>is less than or equal to</option>
                              <option>contains</option>
                              <option>starts with</option>
                              <option>ends with</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-sm-10">
                            <input class="form-control form-control-sm" 
                                   name="filter-text" 
                                   type="text" 
                                   placeholder = "Filter Text"/>
                        </div>
                        <div class="form-group col-sm-2">
                            <button type="submit" class="btn btm-primary">Add <span class="glyphicon glyphicon-plus"></span></button>
                        </div>
                    </div>
                </form>

                <label>Add sorting fields</label>
                <form> 
                    <div class="form-row">
                        <div class="form-group col-sm-5">
                            <input class="form-control form-control-sm" 
                                   name="sort-field" 
                                   type="text" 
                                   placeholder = "Sort field..."/>
                        </div>
                        <div class="form-group col-sm-5">
                            <select class="form-control form-control-sm" name="sort-field-asc">
                                <option>ascending</option>
                                <option>descending</option>
                            </select>
                        </div>

                        <div class="form-group col-sm-2">
                            <button type="submit" class="btn btm-primary">Add <span class="glyphicon glyphicon-plus"></span></button>
                        </div>
                    </div>
                </form> 
                <hr/>
                <label>Saved search terms</label>
                <div id="adj-filters">
                    <div class="adj-variable-group">
                        <span class="adj-variable"><code>location</code> starts with 'Berkeley' <a class="glyphicon glyphicon-plus"></a></span>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="cand_block">
                <ul class="nav nav-pills nav-justified" id="adj-subtabselecter">
                    <li class="subtablinks active nav-item" id="cand-search_button">
                        <a href="#">Search</a>
                    </li>
                    <li class="subtablinks nav-item" id="cand-recent_button">
                        <a href="#">Recent</a>
                    </li>
                </ul>
                <div class="subtab-pane" id="cand-search_block">
                    <div class="cand-event-group">                
                        {% for e in events %}
                        <div class="event-desc" id="cand-event_{{ e.event_id }}">
                            <div class="row">
                                <div class="col-sm-6">
                                    <b>start_date:</b> {{e.start_date}}</br>
                                    <b>location:</b> {{e.location | safe }}<br/>
                                    <b>title:</b> {{e.title | safe }}<br/>
                                </div>
                                <div class="col-sm-3">
                                    <b>event_id:</b> {{ e.event_id }}<br/>
                                    <b>article_id:</b> 
                                        <a href="http://cliff.ssc.wisc.edu/campus_protest_dev/event_creator/{{e.article_id}}" 
                                           target="_blank"
                                           title="{{ e.publication }} ({{ e.pub_date }}) --- {{ e.article_desc|safe }}">{{e.article_id}}</a><br/>
                                    <b>coder:</b> {{ e.coder_id }} <br/>
                                </div>
                                <div class="col-sm-3">
                                    {% if e.event_id in grid_events.keys() %}
                                        <b class="text-muted">In the expanded view</b> <a href="#" class="glyphicon glyphicon-remove"></a><br/>
                                    {% else %}
                                        <b><a href="#">Add to Expand <span class="glyphicon glyphicon-plus"></span></a></b><br/>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <b>desc:</b> {{ e.desc | safe }}<br/>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <nav aria-label="cand-event-pagination">
                        <ul class="pagination">
                        <li class="page-item">
                            <a class="page-link" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                            </a>
                        </li>
                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                            </a>
                        </li>
                        </ul>
                    </nav>
                </div>
                <div class="subtab-pane" id="cand-recent_block" style="display:none;">
                    <div class="cand-event-group">                
                        {% for e in recent_events %}
                        <div class="event-desc" id="recent-cand-event_{{ e.event_id }}">
                            <div class="row">
                                <div class="col-sm-6">
                                    <b>start_date:</b> {{e.start_date}}</br>
                                    <b>location:</b> {{e.location | safe }}<br/>
                                    <b>title:</b> {{e.title | safe }}<br/>
                                </div>
                                <div class="col-sm-3">
                                    <b>event_id:</b> {{ e.event_id }}<br/>
                                    <b>article_id:</b> 
                                        <a href="http://cliff.ssc.wisc.edu/campus_protest_dev/event_creator/{{e.article_id}}" 
                                            target="_blank"
                                            title="{{ e.publication }} ({{ e.pub_date }}) --- {{ e.article_desc|safe }}">{{e.article_id}}</a><br/>
                                    <b>coder:</b> {{ e.coder_id }} <br/>
                                </div>
                                <div class="col-sm-3">
                                    {% if e.event_id in grid_events.keys() %}
                                        <b class="text-muted">In the expanded view</b> <a href="#" class="glyphicon glyphicon-remove"></a><br/>
                                    {% else %}
                                        <b><a href="#">Add to Expand <span class="glyphicon glyphicon-plus"></span></a></b><br/>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <b>desc:</b> {{ e.desc | safe }}<br/>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="canon_block">
                <div class="cand-event-group">
                    <label>Search keys</label>
                    <form> 
                        <div class="form-row">
                            <div class="form-group">
                                <input class="form-control form-control-sm" 
                                       name="search-key" 
                                       type="text" 
                                       placeholder = "Key..."/>
                            </div>    
                        </div>
                    </form>
                    <div class="event-desc" id="canonical-event_{{ canonical_event['key'] }}">
                        <div class="row">
                            <div class="col-sm-8">
                                <b>key: </b> {{ canonical_event['key']|safe }}</br>
                                <b>start_date:</b> {{ canonical_event['start_date'] }}</br>
                                <b>location:</b> {{ canonical_event['location'][0] }}
                            </div>
                            <div class="col-sm-4">
                                <b>Status:</b> {{ canonical_event['status'] }}<br/>
                                <b>Last edited:</b> {{ canonical_event['last_updated'] }}<br/>
                                <!-- TK: Change the logic such that we check if this is the active canonical event -->
                                {% if canonical_event['key'] == canonical_event['key'] %}
                                    <b class="text-muted">Current active event</b> <a href="#" class="glyphicon glyphicon-remove-sign" alt="Remove as active event"></a>
                                {% else %}
                                    <b><a href="#">Make active event <span class="glyphicon glyphicon-export"></span></a></b>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <b>notes: </b> {{ canonical_event['notes']|safe }}<br/>
                                <b>desc:</b> {{ canonical_event['desc'][0]|safe }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="relationships_block">
                <label>Add relationship</label> 
                <form> 
                    <div class="form-row">
                        <div class="form-group col-sm-3">
                            <input class="form-control form-control-sm" 
                                name="search-key-1" 
                                type="text" 
                                placeholder = "Key 1..."/>
                        </div>
                        <div class="form-group col-sm-3">
                            <input class="form-control form-control-sm" 
                                name="search-key-2" 
                                type="text" 
                                placeholder = "Key 2..."/>
                        </div>
                        <div class="form-group col-sm-4">
                            <select class="form-control form-control-sm" name="relationship-type">
                                <option>Campaign</option>
                                <option>Sub-event</option>
                                <option>Counterprotest</option>
                                <option>Solidarity</option>
                                <option>Coordinated</option>
                            </select>
                        </div>
                        <div class="form-group col-sm-2">
                            <button type="submit" class="btn btm-primary">Add <span class="glyphicon glyphicon-plus"></span></button>
                        </div> 
                    </div>
                </form>
                <hr />
                <div class="form-row">
                    <label>View hierarchy</label> </br>
                    <div class="form-group col-sm-8">
                        <input class="form-control form-control-sm" 
                            name="view-key" 
                            type="text" 
                            placeholder = "Key..."/>
                    </div>
                    <p>
                        <img src="static/example-event-hierarchy.png" width="50%"/>                        
                    </p>
                </div>
            </div>     
        </div>
    </div>
    <div class="col-sm-7 adj-pane" id="adj-pane-expanded-view">
        <a id="cand-events-show" style="display:none;" href="#">Show Events &raquo;</a>
        <h4>Expanded Event View | <a href="#">New Canonical Event</a></h4>
        <div id="expanded-event-view-metadata" class="sticky-top">
            <div class="row expanded-event-variable-group">
                <div class="col-sm-1 expanded-event-variable-name">metadata</div>
                {% for event_id in grid_query %}
                <div class="col-sm-{{ grid_width }} expanded-event-variable-col">
                    <label>
                        Event {{ event_id }} <br/> 
                        Actions: 
                        {% for symbol, alt in event_buttons %}
                            <a class="glyphicon glyphicon-{{ symbol }}" title="{{ alt }}" ></a> 
                        {% endfor %}
                    </label> 
                    <div class="expanded-event-variable expanded-event-variable-metadata" id="expanded-event-metadata_{{ event_id }}">
                        <b>title:</b> {{ grid_events[event_id]['title'] | safe }}<br/>
                        <b>publication:</b> {{ grid_events[event_id]['publication'] | safe }}<br/>
                        <b>pub_date:</b> {{ grid_events[event_id]['pub_date'] }}<br/>
                        <b>article_id:</b> 
                            <a href="http://cliff.ssc.wisc.edu/campus_protest_dev/event_creator/{{ grid_events[event_id]['article_id'] }}" target="_blank">
                                {{ grid_events[event_id]['article_id'] }}
                            </a><br/>
                        <b>coder:</b> {{ grid_events[event_id]['coder_id'] }} <br/>
                    </div>
                </div>
                {% endfor %}
                <!-- The Canonical Event Metadata -->
                <div class="col-sm-{{ grid_width }} expanded-event-variable-col">
                    <label>Canonical Event <a class="glyphicon glyphicon-trash" href="#" title="Delete canonical event"></a></label>
                    <div class="expanded-event-variable expanded-event-variable canonical" id="expanded-event-canonical-key_1">
                        <div class="sticky-top data-buttons">
                            <a class="glyphicon glyphicon-pencil" title="Edit"></a> <a class="glyphicon glyphicon-info-sign" title="Info"></a>
                        </div>
                        <b>Key: </b> {{ canonical_event['key'] }}<br />
                    </div>
                    <div class="expanded-event-variable expanded-event-variable canonical">
                        <div class="sticky-top data-buttons">
                            <a class="glyphicon glyphicon-pencil" title="Edit"></a> <a class="glyphicon glyphicon-info-sign" title="Info"></a>
                        </div>
                        <b>Notes: </b>{{ canonical_event['notes']|safe }}<br />
                    </div>
                    <div class="expanded-event-variable expanded-event-variable canonical">
                        <div class="sticky-top data-buttons">
                            <a class="glyphicon glyphicon-pencil" title="Edit"></a> <a class="glyphicon glyphicon-info-sign" title="Info"></a>
                        </div>
                        <b>Status: </b>{{ canonical_event['status'] }}<br />
                    </div>
                </div>
            </div>
        </div>
        <div class="expanded-event-view">
            {% for var in grid_vars %} 
            <div class="row expanded-event-variable-group">
                <div class="col-sm-1 expanded-event-variable-name">{{ var }} 
                    <a class="glyphicon glyphicon-plus" title="Add new value for this field" href=""></a>
                </div>
                <!-- Candidate Event Fields -->
                {% for event_id in grid_query %}
                    <div class="col-sm-{{ grid_width }} expanded-event-variable-col">
                    {% if grid_events[event_id][var]|length > 0 %}
                    {% for value in grid_events[event_id][var] %}
                        <div class="expanded-event-variable grabbable" id="{{ var }}_{{ event_id }}">
                            <div class="sticky-top data-buttons">
                                {% for symbol, alt in candidate_cell_buttons %}
                                    <a class="glyphicon glyphicon-{{ symbol }}" title="{{ alt }}" ></a> 
                                {% endfor %}
                            </div>
                            {{ value | safe }}
                        </div>
                    {% endfor %}
                    {% else %}
                        <div class="expanded-event-variable text-muted">(None)</div>
                    {% endif %}
                    </div>
                {% endfor %}
                <!-- The Canonical Event Fields -->
                <div class="col-sm-{{ grid_width }} expanded-event-variable-col">
                    {% if canonical_event[var]|length > 0 %}
                    {% for value in canonical_event[var] %}
                    <div class="expanded-event-variable canonical" id="expanded-event-metadata_canonical">
                        <div class="sticky-top data-buttons">
                            <a class="glyphicon glyphicon-remove" title="Remove"></a> <a class="glyphicon glyphicon-info-sign" title="Info"></a>
                        </div>
                        {{ value | safe }}
                    </div>
                    {% endfor %}
                    {% else %}
                        <div class="expanded-event-variable canonical text-muted">(None)</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
      </div>
  </div>
</div>
{% endblock %}
