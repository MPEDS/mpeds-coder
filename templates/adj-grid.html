<div id="expanded-event-view-metadata" class="sticky-top">
    <div class="row expanded-event-variable-group">
        <div class="col-sm-1 expanded-event-variable-name">metadata</div>
        {% for event_id in cand_events.keys()|sort %}
        <!-- Candidate Event Metadata -->
        <div class="col-sm-2 expanded-event-variable-col candidate-event" 
            id="candidate-event-metadata_{{ event_id }}"
            data-event="{{ event_id }}"
            data-article="{{ cand_events[event_id]['metadata']['article_id'] }}"
            data-coder="{{ cand_events[event_id]['metadata']['coder_id'] }}">
            <label>
                Event {{ event_id }} <br/> 
                Actions: 
                <a class="glyphicon glyphicon-plus-sign add-all-val" title="Add all values" ></a> 
                {% if event_id in links.keys() %}
                    <a class="glyphicon glyphicon-link text-danger remove-link" 
                       title="Remove link to canonical event"
                       data-key="{{ links[event_id] if event_id in links else '' }}"></a> 
                {% else %}
                    <a class="glyphicon glyphicon-link add-link" title="Link to canonical event" ></a> 
                {% endif %}
                <a class="glyphicon glyphicon-flag flag" title="Flag for later"></a> 
                <a class="glyphicon glyphicon-check completed" title="Mark completed"></a> 
                <a class="glyphicon glyphicon-remove-sign remove-candidate" title="Remove from grid"></a> 
            </label> 
            <div class="expanded-event-variable expanded-event-variable-metadata" 
                id="expanded-event-metadata_{{ event_id }}">
                <b>title:</b> {{ cand_events[event_id]['metadata']['title'] | safe }}<br/>
                <b>publication:</b> {{ cand_events[event_id]['metadata']['publication'] | safe }}<br/>
                <b>pub_date:</b> {{ cand_events[event_id]['metadata']['pub_date'] }}<br/>
                <b>article_id:</b>
                    <a href="{{ url_for('eventCreator', aid = cand_events[event_id]['metadata']['article_id']) }}"
                       target="_blank">
                        {{ cand_events[event_id]['metadata']['article_id'] }}
                    </a><br/>
                <b>coder:</b> {{ cand_events[event_id]['metadata']['coder_id'] }} <br/>
            </div>
        </div>
        {% endfor %}
        <!-- Canonical Event Metadata -->
        <div class="col-sm-2 expanded-event-variable-col canonical-event canonical-event-metadata"
             id="canonical-event-metadata_{{ canonical_event['id'] }}" 
             data-key="{{ canonical_event['key'] }}">
            <label>Canonical Event 
                <a class="glyphicon glyphicon-trash" href="#" title="Delete canonical event"></a>
                <a class="glyphicon glyphicon-remove-sign" href="#" title="Remove from grid"></a>
            </label>
            {% for var in ['key', 'notes', 'status'] %}
            <div class="expanded-event-variable expanded-event-variable canonical" id="expanded-event-canonical-{{ var }}">
                <div class="sticky-top data-buttons">
                    <a class="glyphicon glyphicon-pencil" title="Edit"></a> 
                    <a class="glyphicon glyphicon-info-sign" title="Info"></a>
                </div>
                <b>{{ var|title }}: </b> {{ canonical_event[var]|safe }}<br />
            </div>
            {% endfor %}                        
        </div>
    </div>
</div>
<div class="expanded-event-view">
    {% for var in grid_vars %} 
    <div class="row expanded-event-variable-group">
        <div class="col-sm-1 expanded-event-variable-name">{{ var }} 
            <a class="glyphicon glyphicon-plus" title="Add new value for this field" href=""></a>
        </div>
        <!-- Candidate Event Fields -->
        {% for event_id in cand_events.keys()|sort %}
            <div class="col-sm-2 expanded-event-variable-col">
            {% if cand_events[event_id][var]|length > 0 %}
            {% for value, cec_id, timestamp in cand_events[event_id][var] %}
                <div class="expanded-event-variable" data-var="{{ var }}">
                    <div class="sticky-top data-buttons">
                        <a class="glyphicon glyphicon-plus add-val" 
                           title="Add to canonical event" 
                           data-key="{{ cec_id }}"></a>
                        <a class="glyphicon glyphicon-info-sign"
                           title="Edited on {{ timestamp }}"></a>
                    </div>
                    <div class="expanded-event-value">{{ value | safe }}</div>
                </div>
            {% endfor %}
            {% else %}
                <div class="expanded-event-variable text-muted none">(None)</div>
            {% endif %}
            </div>
        {% endfor %}
        <!-- Canonical Event Fields -->
        <div class="col-sm-2 expanded-event-variable-col canonical-event" id="canonical-event_{{ var }}">
            {% if canonical_event and canonical_event[var]|length > 0 %}
            {% for cel_id, value, timestamp, _ in canonical_event[var] %}
                {% include 'canonical-cell.html' %}
            {% endfor %}
            {% else %}
                <div class="expanded-event-variable canonical text-muted none">(None)</div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>